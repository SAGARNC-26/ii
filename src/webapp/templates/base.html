<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Smart Vault CCTV{% endblock %}</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <!-- Custom CSS -->
    <style>
      :root {
        --primary-color: #2c3e50;
        --success-color: #27ae60;
        --danger-color: #e74c3c;
        --warning-color: #f39c12;
        --info-color: #3498db;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
      }

      .sidebar {
        min-height: 100vh;
        background: linear-gradient(
          180deg,
          var(--primary-color) 0%,
          #34495e 100%
        );
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }

      .sidebar .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 12px 20px;
        margin: 5px 10px;
        border-radius: 5px;
        transition: all 0.3s;
      }

      .sidebar .nav-link:hover,
      .sidebar .nav-link.active {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff;
      }

      .sidebar .nav-link i {
        margin-right: 10px;
        width: 20px;
      }

      .navbar {
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .stat-card {
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
      }

      .stat-card:hover {
        transform: translateY(-5px);
      }

      .stat-card.success {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .stat-card.danger {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .stat-card.warning {
        background: linear-gradient(135deg, #ffa751 0%, #ffe259 100%);
        color: white;
      }

      .stat-card.info {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      .alert-notification {
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        animation: slideIn 0.3s;
      }

      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .face-thumbnail {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 5px;
      }

      .badge-status {
        font-size: 0.85em;
        padding: 5px 10px;
      }

      .logo {
        padding: 20px;
        text-align: center;
        color: white;
        font-size: 1.5em;
        font-weight: bold;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .logo i {
        margin-right: 10px;
      }
    </style>

    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <!-- Sidebar -->
    <div class="container-fluid">
      <div class="row">
        <nav class="col-md-2 d-md-block sidebar">
          <div class="logo">
            <i class="fas fa-shield-alt"></i>
            Smart Vault
          </div>
          <div class="position-sticky pt-3">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}"
                  href="{{ url_for('dashboard') }}"
                >
                  <i class="fas fa-tachometer-alt"></i>
                  Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'logs_page' %}active{% endif %}"
                  href="{{ url_for('logs_page') }}"
                >
                  <i class="fas fa-list"></i>
                  Access Logs
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'security_page' %}active{% endif %}"
                  href="{{ url_for('security_page') }}"
                >
                  <i class="fas fa-exclamation-triangle"></i>
                  Security Logs
                </a>
              </li>
              <!-- <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'unknowns_page' %}active{% endif %}" href="{{ url_for('unknowns_page') }}">
                                <i class="fas fa-users"></i>
                                Authorized Persons
                            </a>
                        </li>  -->
              <li class="nav-item">
                <a
                  class="nav-link {% if request.endpoint == 'enroll_page' %}active{% endif %}"
                  href="{{ url_for('enroll_page') }}"
                >
                  <i class="fas fa-user-plus"></i>
                  Enroll Person
                </a>
              </li>
              <li class="nav-item mt-4">
                <a class="nav-link" href="{{ url_for('logout') }}">
                  <i class="fas fa-sign-out-alt"></i>
                  Logout
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-10 ms-sm-auto px-md-4">
          <!-- Top navbar -->
          <nav class="navbar navbar-light bg-light mb-4 rounded mt-3">
            <div class="container-fluid">
              <h4 class="mb-0">
                {% block page_title %}Dashboard{% endblock %}
              </h4>
              <span class="navbar-text">
                <i class="fas fa-user-circle"></i>
                {{ username }}
              </span>
            </div>
          </nav>

          <!-- Notification container -->
          <div id="notification-container"></div>

          <!-- Page content -->
          {% block content %}{% endblock %}
        </main>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Socket.IO connection -->
    <script>
      const socket = io();

      socket.on("connect", () => {
        console.log("Connected to server");
      });

      socket.on("disconnect", () => {
        console.log("Disconnected from server");
      });

      // Show notification
      function showNotification(message, type = "info") {
        const container = document.getElementById("notification-container");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type} alert-dismissible fade show alert-notification`;
        alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
        container.appendChild(alert);

        // Auto-dismiss after 5 seconds
        setTimeout(() => {
          alert.remove();
        }, 5000);
      }

      // Listen for security alerts
      socket.on("security_alert", (data) => {
        showNotification(
          `<strong>Security Alert!</strong><br>${
            data.message || JSON.stringify(data)
          }`,
          "danger"
        );
      });

      // Listen for new detections
      socket.on("new_detection", (data) => {
        console.log("New detection:", data);
      });
    </script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
